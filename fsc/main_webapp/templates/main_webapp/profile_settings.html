
{% load static %}

  
  <h4>Profile Settings</h4>
  <div class="empty-div"></div>
  
  <form id="profile_settings" class="form" action="{% url 'fsc-settings' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group form-inline">
            <label for="dp">Profile Picture</label>
            <img class="user-dp-preview" src="{{ user.profile.dp.url }}"></img>
            <input type="file" class="form-control dp-input" id="dp" name="dp">
        </div>
        <div class="form-group form-inline">
          <label for="dob">Birthday</label>
          <input type="date" class="form-control" id="dob" name="dob" value="{% if user.profile.dob %}{{ user.profile.dob|date:'Y-m-d' }}{% else %}{% endif %}">
        </div>
        <div class="form-group form-inline">
          <label for="bio">Bio</label>
          <textarea type="text" class="form-control text-area" id="bio" name="bio" placeholder="Enter bio" >{% if user.profile.bio %}{{ user.profile.bio }}{% else %}{% endif %}</textarea>
        </div>
        <div class="form-group form-half">
          <button type="submit" class="btn btn-dark mb-2 user-form" name="profile_settings">Submit</button>
        </div>
  </form>

  <script type="text/javascript">
    $(document).ready(function(){
      var $myForm = $("#profile_settings")
      $myForm.submit(function(e){
      e.preventDefault();
      var data =  new FormData($('#profile_settings').get(0));
      data.append('profile_settings', 'profile_settings');

      $.ajax({
        url: "{% url 'fsc-settings' %}",
        type: 'POST',
        data: data,
        async: true,
        cache: false,
        contentType: false,
        enctype: 'multipart/form-data',
        processData: false,
        success:function(data){
          document.getElementById('bio').value = data['bio']
          document.getElementsByClassName('user-dp-preview')[0].src = data['dp']
          document.getElementsByClassName('user-dp-nav')[0].src = data['dp']
          var date = new Date(data['dob']);
          var currentDate = date.toISOString().split('T')[0];
          document.getElementById('dob').value = currentDate
        },
        error:function(data){
          alert(data)
        }
      });
      return false;

    });
    });
  
  </script>



